<!DOCTYPE html>
<meta charset="utf-8">
<style>

    .links line {
        stroke: #999;
        stroke-opacity: 0.6;
    }

    .nodes circle {
        stroke: #fff;
        stroke-width: 1.5px;
    }

</style>
<svg width="1600" height="900"></svg>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script type="application/javascript" src="https://d3js.org/d3.v4.min.js"></script>
<script>
    let svg = d3.select("svg"),
        width = +svg.attr("width"),
        height = +svg.attr("height");

    $.getJSON("{% url 'graph_data' %}", function(json) {
        console.log(json);

        let nodes_data = json['people'];

        let simulation = d3.forceSimulation().nodes(nodes_data);

        simulation
            .force("charge_force", d3.forceManyBody())
            .force("center_force", d3.forceCenter(width / 2, height / 2));

        let node = svg.append("g")
            .attr("class", "nodes")
            .selectAll("circle")
            .data(nodes_data)
            .enter()
            .append("circle")
            .attr("r", 5)
            .attr("fill", "red");

        simulation.on("tick", tickActions);

        let links_data = json['relationships'];

        let link_force = d3.forceLink(links_data)
            .id(function (d) {
                return d.name;
            });

        simulation.force("links", link_force);

        //draw lines for the links
        let link = svg.append("g")
            .attr("class", "links")
            .selectAll("line")
            .data(links_data)
            .enter().append("line")
            .attr("stroke-width", 2);

        function tickActions() {
            node
                .attr("cx", function (d) {
                    return d.x;
                })
                .attr("cy", function (d) {
                    return d.y;
                });
            link
                .attr("x1", function (d) {
                    return d.source.x;
                })
                .attr("y1", function (d) {
                    return d.source.y;
                })
                .attr("x2", function (d) {
                    return d.target.x;
                })
                .attr("y2", function (d) {
                    return d.target.y;
                });
        }
    });
</script>